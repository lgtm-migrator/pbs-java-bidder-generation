# bidder-generation-tool

## Description

A tool that generates bidder-specific files required for PreBid Server(PBS) from a specific .json file. 
That input file should contain all necessary information provided by client(i.e. should be generated by front-end in future), as well as a path to local PBS directory.

See src/test_input.json for example of input json file with data and its format.

## Supported Transformations

The tool doesn't support type casting, therefore fields should be modified with an appropriate type value whether it's a literal or value taken from another field.
Also, tool doesn't support conditional changes, like the ones that could modify a certain field depending on some condition. 

OpenRTB fields that cannot be modified(i.e. have a value assigned to them):
1. `request.site.content`, `request.app.content`;
1. Any exchange-specific extensions to OpenRTB (`.ext` fields);
1. A specific element of list, array or sequence.

Currently supported transformations:
1. Static transformations, e.g. setting a constant value(or null) to a field: 
`request.imp.id = "id"`, `request.at = 1`, `request.imp[i].banner.format = null`;
2. Dynamic transformations, e.g. value taken from another field:
    * On impression level - values can be taken from `request.imp[i]` and `request.imp[i].ext.bidder.`, 
    where `imp[i]` is a current impression and `.ext.bidder` - bidder-specific impression extension. For example: 
    `request.imp[i].tagid <- request.imp[i].ext.bidder.bidderField`
    `request.imp[i].banner.id <- request.imp[i].id`    
    * On request level - values can be taken from any `request` field, except selecting a specific value from list, 
    array or sequence fields, e.g. an array can be assigned from another array field, but `array[i]` cannot be assigned 
    to specific field. For example:
    `request.site.publisher.id <- request.id`
    `request.app.id <- request.app.content.producer.id`
    `request.test <- request.site.privacypolicy`

Finally, if an OpenRTB Object's field needs to be modified, tool either modifies an existing object, or creates a new one and sets target field(other fields would be empty).

All above-mentioned transformations can be manually customized in case something cannot be done via code generation by modifying `{BidderName}Bidder.java` file.
     
## Generated Files

The tool generates following files in local PBS directory:
1. `src/main/java/org/prebid/server/bidder/{biddername}/{BidderName}Bidder.java` - java class that handles bidder request transformations;
1. `src/main/java/org/prebid/server/bidder/{biddername}/{BidderName}Usersyncer.java` - java class that handles user sync;
1. `src/main/java/org/prebid/server/spring/config/bidder/{BidderName}Configuration.java` - bidder java configuration class;
1. `src/main/java/org/prebid/server/proto/openrtb/ext/request/{biddername}/ExtImp{BidderName}.java` - java class that is a model for bidder-specific extension, passed in request.imp.ext.bidder;
1. `src/main/resources/bidder-config/{biddername}.yaml` - bidder configuration properties and meta info file;
1. `src/main/resources/static/bidder-params/{bidderName}.json` - bidder json schema that describes bidder-specific parameters;
1. `src/test/java/org/prebid/server/bidder/{biddername}/{BidderName}UsersyncerTest.java` - java test class for bidder's Usersyncer;
1. `src/test/java/org/prebid/server/bidder/{biddername}/{BidderName}BidderTest.java` - java test class for Bidder class**

 ****NOTE: ATM generates tests only for cases when bidder has no extension and doesn't apply any transformations.**

## How to run

Prerequisites:
- Java 8+
- Maven 3.3+

Requires input json file(in corresponding format) to be passed in requested body and PBS server files locally on user's PC(a path to directory should be specified in previously-mentioned json file).

Steps:

1. Clone the bidder-generation-tool repository with `git@github.com:rubicon-project/pbs-java-bidder-generation.git` command

2. Run with command `mvn spring-boot:run`

3. Send a POST request to `http://localhost:8080/generate` with a header `Content-Type : application/json` and json body containing bidder description properties and local PBS directory path.

4. Check the results in your local PBS directory or project.
